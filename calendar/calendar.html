<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Grist Calendar</title>
    <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
    <style>
body {
	margin: 0;
}

#calendar-wrapper {
	display: grid;
	grid-template-columns: repeat(7, 1fr);
	height: 100vh;
}

.five-rows {
	grid-template-rows: auto repeat(5, 1fr);
}
	
.six-rows {
	grid-template-rows: auto repeat(6, 1fr);
}

/* top border on first 7 blocks (top row) */
.calendar-block:nth-child(-n+7) {
	border-top: 1px solid black;
}

/* left border on every 7th block (left column) */
.calendar-block:nth-child(7n+1) {
	border-left: 1px solid black;
}

/* bottom and right border on every block */
.calendar-block {
	width: 100%;
	height: auto;
	border-right: 1px solid black;
	border-bottom: 1px solid black;
	box-sizing: border-box;
}

.five-rows .calendar-block.sixth-row {
	display: none;
}

.calendar-block > span {
	margin-left: 5px;
	margin-top: 2px;
}

.center {
	text-align: center;
}

.d-flex {
	display: flex;
}

    </style>
  </head>
  <body>
    <div id="calendar-wrapper" class="six-rows">
	    <div class="calendar-block center">Sunday</div>
	    <div class="calendar-block center">Monday</div>
	    <div class="calendar-block center">Tuesday</div>
	    <div class="calendar-block center">Wednesday</div>
	    <div class="calendar-block center">Thursday</div>
	    <div class="calendar-block center">Friday</div>
	    <div class="calendar-block center">Saturday</div>

	    <div class="calendar-block d-flex" id="block0"><span></span></div>
	    <div class="calendar-block d-flex" id="block1"><span></span></div>
	    <div class="calendar-block d-flex" id="block2"><span></span></div>
	    <div class="calendar-block d-flex" id="block3"><span></span></div>
	    <div class="calendar-block d-flex" id="block4"><span></span></div>
	    <div class="calendar-block d-flex" id="block5"><span></span></div>
	    <div class="calendar-block d-flex" id="block6"><span></span></div>

	    <div class="calendar-block d-flex" id="block7"><span></span></div>
	    <div class="calendar-block d-flex" id="block8"><span></span></div>
	    <div class="calendar-block d-flex" id="block9"><span></span></div>
	    <div class="calendar-block d-flex" id="block10"><span></span></div>
	    <div class="calendar-block d-flex" id="block11"><span></span></div>
	    <div class="calendar-block d-flex" id="block12"><span></span></div>
	    <div class="calendar-block d-flex" id="block13"><span></span></div>

	    <div class="calendar-block d-flex" id="block14"><span></span></div>
	    <div class="calendar-block d-flex" id="block15"><span></span></div>
	    <div class="calendar-block d-flex" id="block16"><span></span></div>
	    <div class="calendar-block d-flex" id="block17"><span></span></div>
	    <div class="calendar-block d-flex" id="block18"><span></span></div>
	    <div class="calendar-block d-flex" id="block19"><span></span></div>
	    <div class="calendar-block d-flex" id="block20"><span></span></div>

	    <div class="calendar-block d-flex" id="block21"><span></span></div>
	    <div class="calendar-block d-flex" id="block22"><span></span></div>
	    <div class="calendar-block d-flex" id="block23"><span></span></div>
	    <div class="calendar-block d-flex" id="block24"><span></span></div>
	    <div class="calendar-block d-flex" id="block25"><span></span></div>
	    <div class="calendar-block d-flex" id="block26"><span></span></div>
	    <div class="calendar-block d-flex" id="block27"><span></span></div>

	    <div class="calendar-block d-flex" id="block28"><span></span></div>
	    <div class="calendar-block d-flex" id="block29"><span></span></div>
	    <div class="calendar-block d-flex" id="block30"><span></span></div>
	    <div class="calendar-block d-flex" id="block31"><span></span></div>
	    <div class="calendar-block d-flex" id="block32"><span></span></div>
	    <div class="calendar-block d-flex" id="block33"><span></span></div>
	    <div class="calendar-block d-flex" id="block34"><span></span></div>

	    <div class="calendar-block d-flex sixth-row" id="block35"><span></span></div>
	    <div class="calendar-block d-flex sixth-row" id="block36"><span></span></div>
	    <div class="calendar-block d-flex sixth-row" id="block37"><span></span></div>
	    <div class="calendar-block d-flex sixth-row" id="block38"><span></span></div>
	    <div class="calendar-block d-flex sixth-row" id="block39"><span></span></div>
	    <div class="calendar-block d-flex sixth-row" id="block40"><span></span></div>
	    <div class="calendar-block d-flex sixth-row" id="block41"><span></span></div>
	    
    </div>

    <script>
      function buildCalendar(target) {
        let calendarWrapper = document.getElementById("calendar-wrapper");
      
        // start with just 5 rows in calendar
        calendarWrapper.classList.remove('six-rows');
        calendarWrapper.classList.add('five-rows');
      
        function getFirstIndexOfMonth(target) {
          return new Date(target.getFullYear(), target.getMonth(), 1).getDay();
        }
      
        const daysInMonth = (year, month) => new Date(year, month, 0).getDate();
      
        let numDaysInMonth = daysInMonth(target.getFullYear(), target.getMonth()+1);
        let index = getFirstIndexOfMonth(target);
      
        console.log(`target: ${target}`);
        console.log(`getFirstIndexOfMonth: ${index}`);
        console.log(`numDaysInMonth: ${numDaysInMonth}`);
      
        for (let i = 1; i <= numDaysInMonth; i++) {
          console.log(`block${index}`);
          let block = document.getElementById(`block${index}`);
          if (block) {
            let span = block.querySelector('span');
            console.log(span);
            span.innerText = `${i}`;
          }
          if (index >= 35) {
            // we have six rows
            calendarWrapper.classList.add('six-rows');
            calendarWrapper.classList.remove('five-rows');
          }
          index += 1;
      
        }
      }
      
      let target = new Date(2023, 4, 15);
      buildCalendar(target);
      
      grist.ready();
      grist.onRecords(function(records) {
        // document.getElementById('readout').innerHTML = JSON.stringify(records, null, 2);
      });
    </script>
  </body>
</html>
